<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Write Your Story - Novelite</title>
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<style>
body{font-family:Arial,sans-serif;margin:0;padding:0;background:#f8f8f8;color:#000;}
.container{max-width:800px;margin:2rem auto;padding:1rem;background:#fff;border-radius:12px;box-shadow:0 3px 10px rgba(0,0,0,0.1);}
h2{color:#006400;margin-bottom:1rem;}
label{display:block;margin:0.5rem 0;font-weight:bold;}
input, select, button{width:100%;padding:0.5rem;margin-bottom:1rem;border-radius:6px;border:1px solid #ccc;font-size:1rem;}
button{background:#FFD700;color:#fff;border:none;font-weight:bold;cursor:pointer;transition:.3s;}
button:hover{background:#e6c200;}
#coverPreview{width:150px;height:200px;object-fit:cover;margin-bottom:1rem;border-radius:8px;}
</style>
</head>
<body>
<div class="container">
    <h2>Create a New Story</h2>
    
    <label>Title</label>
    <input type="text" id="title">

    <label>Description</label>
    <div id="editor" style="height:150px;background:#fff;"></div>

    <label>Cover Image</label>
    <input type="file" id="coverInput" accept="image/*">
    <img id="coverPreview" src="" alt="Cover Preview">

    <label>Price (optional)</label>
    <input type="number" id="price" placeholder="0">

    <label>Feature / Recommend</label>
    <select id="tags">
        <option value="">None</option>
        <option value="featured">Featured</option>
        <option value="recommended">Recommended</option>
    </select>

    <label>Upload Existing Story (PDF)</label>
    <input type="file" id="pdfInput" accept=".pdf">

    <button id="submitBtn">Submit Story</button>
</div>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
const quill = new Quill('#editor', {theme:'snow'});
const coverInput = document.getElementById('coverInput');
const coverPreview = document.getElementById('coverPreview');
const pdfInput = document.getElementById('pdfInput');

coverInput.addEventListener('change', e=>{
    const file = e.target.files[0];
    if(file){
        coverPreview.src = URL.createObjectURL(file);
    }
});

document.getElementById('submitBtn').addEventListener('click', async ()=>{
    const title = document.getElementById('title').value.trim();
    const desc = quill.root.innerHTML.trim();
    const price = document.getElementById('price').value || 0;
    const tag = document.getElementById('tags').value;
    const authorId = 'testUser123'; // replace with logged-in user
    const authorName = 'John Doe';   // replace with logged-in user

    if(!title || (!desc && !pdfInput.files[0])) { alert('Add title and content or PDF'); return; }

    const formData = new FormData();
    formData.append('title', title);
    formData.append('desc', desc || '');
    formData.append('price', price);
    formData.append('authorId', authorId);
    formData.append('authorName', authorName);
    if(tag==='featured') formData.append('featured', 'true');
    if(tag==='recommended') formData.append('recommended', 'true');
    if(coverInput.files[0]) formData.append('cover', coverInput.files[0]);
    if(pdfInput.files[0]) formData.append('pdf', pdfInput.files[0]);

    try{
        const res = await fetch('/api/stories', {method:'POST', body:formData});
        const story = await res.json();
        alert('Story uploaded successfully!');
        // reset form
        document.getElementById('title').value='';
        quill.root.innerHTML='';
        coverInput.value='';
        coverPreview.src='';
        pdfInput.value='';
    }catch(err){console.error(err); alert('Upload failed');}
});
</script>
</body>
</html>
