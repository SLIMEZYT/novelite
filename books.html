<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Novelite Books</title>
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<style>
:root {
    --royal-green:#006400; --gold:#FFD700; --white:#fff;
}

/* Loader */
#loader {
    position:fixed; top:0; left:0;width:100%; height:100%;
    background:var(--royal-green); color:var(--white);
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    z-index:100000;
}
.spinner {
    border:6px solid rgba(255,255,255,0.3);
    border-top:6px solid var(--gold); border-radius:50%; width:50px; height:50px;
    animation:spin 1s linear infinite; margin-bottom:1rem;
}
@keyframes spin {100%{transform:rotate(360deg);}}

/* Body & Hero */
body {margin:0;padding:0;font-family:Arial,sans-serif;background:#f8f8f8;color:#000;}
.hero {background:linear-gradient(135deg,var(--royal-green),var(--gold)); color:var(--white); text-align:center; padding:4rem 1rem;}
.hero h1{font-size:2.5rem;margin-bottom:1rem;}
.hero p{font-size:1.2rem;margin-bottom:2rem;}
.hero button{background:var(--white);color:var(--royal-green);border:none;padding:.8rem 2rem;border-radius:25px;font-size:1rem;cursor:pointer;font-weight:bold;transition:.3s;}
.hero button:hover{background:rgba(255,255,255,.8);}

/* Sections */
section{padding:2rem 1rem; opacity:0; transform:translateY(20px); transition:all .6s ease;}
section.visible{opacity:1; transform:translateY(0);}
.section-title{font-size:1.5rem;font-weight:bold;color:var(--royal-green);margin-bottom:1rem;}
.books-grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:1rem;}

/* Book card */
.book-card{background:var(--white);border-radius:16px;box-shadow:0 5px 20px rgba(0,0,0,0.1);text-align:center;cursor:pointer;padding:.5rem;position:relative;transition:.3s;}
.book-card:hover{transform:translateY(-5px) scale(1.03);box-shadow:0 15px 25px rgba(0,0,0,0.2);}
.book-card img{width:100%;border-radius:12px; height:240px; object-fit:cover;}
.book-card h3{margin:.3rem 0;font-size:1rem;color:var(--royal-green);}
.book-card p{margin:.2rem 0;font-size:.85rem;height:2.5em;overflow:hidden;}
.book-card .author{font-size:.75rem;color:#555;margin-bottom:.3rem;}
.fav-btn{position:absolute;top:8px;right:8px;font-size:20px;cursor:pointer;color:#ccc;transition:.2s;}
.fav-btn.active{color:var(--gold);}
.progress-container{height:6px;background:#eee;border-radius:3px;margin-top:4px;}
.progress-bar{height:100%;background:var(--gold);border-radius:3px;width:0%;}

/* PDF button */
.pdf-btn{display:inline-block;margin-top:4px;padding:.3rem .6rem;font-size:.75rem;background:var(--royal-green);color:var(--white);border-radius:6px;text-decoration:none;transition:.3s;}
.pdf-btn:hover{background:var(--gold); color:var(--royal-green);}

/* Modal */
#bookModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);justify-content:center;align-items:center;z-index:10000;}
.modal-content{background:var(--white);padding:1rem;border-radius:12px;width:90%;max-width:400px;text-align:center;}
.modal-content img{width:100%;border-radius:12px;margin-bottom:.5rem;}
.modal-content h3{color:var(--royal-green);margin:.5rem 0;}
.modal-content button{padding:.5rem 1rem;background:var(--gold);color:var(--white);border:none;border-radius:6px;cursor:pointer;margin-top:.5rem;}

/* ============ BOTTOM LIQUID GLASS NAV ============ */
.bottom-nav{
  position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
  width: min(560px, 92%); display:flex; justify-content:space-between; align-items:center; gap:8px;
  padding:10px 12px; border-radius:22px;
  background: rgba(255,255,255,0.15); backdrop-filter: blur(15px) saturate(150%);
  border:1px solid rgba(255,255,255,0.3);
  box-shadow: 0 10px 30px rgba(0,0,0,.15);
  z-index:9000; animation: floatbar 4s ease-in-out infinite;
}
@keyframes floatbar{50%{transform:translateX(-50%) translateY(-3px)}}

.nav-btn{
  flex:1; display:flex; flex-direction:column; align-items:center; gap:6px;
  padding:8px 6px; border-radius:14px; cursor:pointer; user-select:none;
  color:#0f0f0f; text-decoration:none; font-size:12px; font-weight:600;
  transition:.2s; position:relative; overflow:hidden;
}
.nav-btn .ico{font-size:18px}
.nav-btn:hover{background:rgba(255,255,255,.25)}
.nav-btn.active{background:rgba(255,215,0,.25); border:1px solid rgba(255,255,255,.3)}
.nav-btn.active .ico, .nav-btn.active span{color:var(--royal-green)}
.nav-btn:after{
  content:""; position:absolute; width:8px; height:8px; background:rgba(255,215,0,.6); border-radius:50%;
  transform:scale(0); opacity:0; pointer-events:none;
}
.nav-btn:active:after{
  animation:ripple 0.6s linear forwards;
}
@keyframes ripple{
  0%{transform:scale(0); opacity:0.6;}
  100%{transform:scale(15); opacity:0;}
}

/* Responsive */
@media(max-width:500px){.books-grid{grid-template-columns:repeat(auto-fill,minmax(140px,1fr));} .hero h1{font-size:2rem;} .hero p{font-size:1rem;}}
</style>
</head>
<body>

<!-- Loader -->
<div id="loader">
    <div class="spinner"></div>
    <p>Loading Books...</p>
</div>

<!-- Hero -->
<div class="hero">
    <h1>Discover Your Next Read</h1>
    <p>Explore, Favourite, and Download Novels</p>
    <button onclick="scrollToSection('featured')">Browse Books</button>
</div>

<!-- Sections -->
<section id="featured"><h2 class="section-title">Featured Books</h2><div id="featured-container" class="books-grid"><p>Loading...</p></div></section>
<section id="newArrivals"><h2 class="section-title">New Arrivals</h2><div id="new-container" class="books-grid"><p>Loading...</p></div></section>
<section id="recommended"><h2 class="section-title">Recommended</h2><div id="rec-container" class="books-grid"><p>Loading...</p></div></section>
<section id="continue"><h2 class="section-title">Continue Reading</h2><div id="continue-container" class="books-grid"><p>Loading...</p></div></section>
<section id="wishlist"><h2 class="section-title">Wishlist</h2><div id="wishlist-container" class="books-grid"><p>Loading...</p></div></section>

<!-- Modal -->
<div id="bookModal">
    <div class="modal-content">
        <img id="modalCover" src="" alt="Book Cover">
        <h3 id="modalTitle"></h3>
        <p id="modalDesc"></p>
        <p class="author" id="modalAuthor"></p>
        <a id="pdfBtn" class="pdf-btn" href="#" target="_blank" style="display:none;">Download PDF</a>
        <button id="favBtn">Add to Favourites</button>
        <button onclick="closeModal()">Close</button>
    </div>
</div>

<!-- Bottom Nav -->
<nav class="bottom-nav">
    <a href="home.html" class="nav-btn"><span class="ico">üè†</span><span>Home</span></a>
    <a href="books.html" class="nav-btn"><span class="ico">üìö</span><span>Books</span></a>
    <a href="write.html" class="nav-btn"><span class="ico">‚úçÔ∏è</span><span>Write</span></a>
    <a href="home.html" class="nav-btn"><span class="ico">üìù</span><span>Blog</span></a>
    <a href="home.html" class="nav-btn"><span class="ico">üë§</span><span>Profile</span></a>
</nav>

<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
// Loader & section animation
document.addEventListener('DOMContentLoaded',()=>{
    setTimeout(()=>{document.getElementById('loader').style.display='none'; fetchBooks(); checkSections(); setActiveNav();},800);
    window.addEventListener('scroll', checkSections);
});

// Fade-in sections
const sections = document.querySelectorAll('section');
function checkSections(){
    const trigger = window.innerHeight * 0.85;
    sections.forEach(sec=>{if(sec.getBoundingClientRect().top<trigger) sec.classList.add('visible');});
}

// Scroll helper
function scrollToSection(id){document.getElementById(id).scrollIntoView({behavior:'smooth'});}

// Set active nav button
function setActiveNav(){
    const navLinks = document.querySelectorAll('.bottom-nav .nav-btn');
    const currentPath = window.location.pathname;
    navLinks.forEach(link=>{
        if(link.getAttribute('href') === currentPath){
            link.classList.add('active');
        } else {
            link.classList.remove('active');
        }
    });
}

// Books data
let books = []; let wishlist = [];

// Fetch books dynamically
async function fetchBooks(){
    try{
        const res = await fetch('/api/stories');
        books = await res.json();

        const featured = books.filter(b=>b.featured);
        const newArrivals = books.slice(-6);
        const recommended = books.filter(b=>b.recommended);
        const continueReading = books.filter(b=>b.progress>0);
        const wishlistRes = await fetch('/api/books/wishlist?userId=testUser123');
        wishlist = await wishlistRes.json();

        renderBooks('featured-container',featured);
        renderBooks('new-container',newArrivals);
        renderBooks('rec-container',recommended);
        renderBooks('continue-container',continueReading,true);
        renderBooks('wishlist-container',books.filter(b=>wishlist.includes(b.id)));
    }catch(err){console.error(err);}
}

// Render book cards
function renderBooks(containerId,arr,showProgress=false){
    const container=document.getElementById(containerId);
    container.innerHTML='';
    if(arr.length===0){container.innerHTML='<p>No books available</p>'; return;}
    arr.forEach(book=>{
        const card=document.createElement('div'); card.className='book-card';
        card.innerHTML=`<img src="${book.cover || 'https://via.placeholder.com/180x240'}" alt="cover">
        <h3>${book.title}</h3><p>${book.desc.replace(/<[^>]*>?/gm,'')}</p>
        <p class="author">${book.authorName}</p>
        <div class="fav-btn ${wishlist.includes(book.id)?'active':''}" onclick="toggleFav(${book.id},event)">‚òÖ</div>
        ${book.pdf?`<a href="${book.pdf}" class="pdf-btn" target="_blank">Download PDF</a>`:''}
        ${showProgress?`<div class="progress-container"><div class="progress-bar" style="width:${book.progress}%"></div></div>`:''}`;
        card.onclick=()=>openModal(book);
        container.appendChild(card);
    });
}

// Modal
const modal=document.getElementById('bookModal');
function openModal(book){
    modal.style.display='flex';
    document.getElementById('modalCover').src=book.cover||'https://via.placeholder.com/300x400';
    document.getElementById('modalTitle').textContent=book.title;
    document.getElementById('modalDesc').innerHTML=book.desc;
    document.getElementById('modalAuthor').textContent=book.authorName;
    const pdfBtn=document.getElementById('pdfBtn');
    if(book.pdf){pdfBtn.href=book.pdf; pdfBtn.style.display='inline-block';}else{pdfBtn.style.display='none';}
    document.getElementById('favBtn').onclick=()=>toggleFav(book.id);
}
function closeModal(){modal.style.display='none';}

// Toggle favourite
async function toggleFav(bookId,event=null){
    if(event) event.stopPropagation();
    try{
        const res=await fetch('/api/books/favourite',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({userId:'testUser123',bookId})
        });
        wishlist=await res.json();
        fetchBooks();
    }catch(err){console.error(err);}
}
</script>
</body>
</html>
